<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">
    <div class="max-w-4xl mx-auto p-6">
        <h1 class="text-3xl font-bold mb-6">Admin Dashboard</h1>

        {% if error %}
            <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert">
                <p>{{ error }}</p>
            </div>
        {% endif %}

        <!-- Shipment Creation Form -->
        <div class="bg-white shadow-md rounded-lg p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">Create Shipment</h2>
            <form method="POST" action="{{ url_for('admin') }}">
                <input type="hidden" name="form_type" value="shipment">
                <div class="mb-4">
                    <label class="block text-gray-700">Tracking Number</label>
                    <input type="text" name="tracking" class="w-full p-2 border rounded" required maxlength="50">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Title</label>
                    <input type="text" name="title" class="w-full p-2 border rounded" value="Consignment" maxlength="100">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Origin (address or lat,lng)</label>
                    <input type="text" name="origin" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Destination (address or lat,lng)</label>
                    <input type="text" name="destination" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Status</label>
                    <select name="status" class="w-full p-2 border rounded" required>
                        <option value="Created">Created</option>
                        <option value="In Transit">In Transit</option>
                        <option value="Out for Delivery">Out for Delivery</option>
                        <option value="Delivered">Delivered</option>
                    </select>
                </div>
                <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">Create Shipment</button>
            </form>
        </div>

        <!-- Checkpoint Creation Form -->
        <div class="bg-white shadow-md rounded-lg p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">Add Checkpoint</h2>
            <form method="POST" action="{{ url_for('admin') }}">
                <input type="hidden" name="form_type" value="checkpoint">
                <div class="mb-4">
                    <label class="block text-gray-700">Tracking Number</label>
                    <input type="text" name="tracking" class="w-full p-2 border rounded" required maxlength="50">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Location (address or lat,lng)</label>
                    <input type="text" name="location" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Label</label>
                    <input type="text" name="label" class="w-full p-2 border rounded" required maxlength="100">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Note</label>
                    <textarea name="note" class="w-full p-2 border rounded" maxlength="500"></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Status</label>
                    <select name="status" class="w-full p-2 border rounded">
                        <option value="">No Change</option>
                        <option value="Created">Created</option>
                        <option value="In Transit">In Transit</option>
                        <option value="Out for Delivery">Out for Delivery</option>
                        <option value="Delivered">Delivered</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Proof Photo URL</label>
                    <input type="text" name="proof_photo" class="w-full p-2 border rounded" maxlength="500">
                </div>
                <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">Add Checkpoint</button>
            </form>
        </div>

        <!-- Simulation Form -->
        <div class="bg-white shadow-md rounded-lg p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">Start Simulation</h2>
            <form method="POST" action="{{ url_for('admin') }}">
                <input type="hidden" name="form_type" value="simulation">
                <div class="mb-4">
                    <label class="block text-gray-700">Tracking Number</label>
                    <input type="text" name="tracking" class="w-full p-2 border rounded" required maxlength="50">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Number of Checkpoints (2-10)</label>
                    <input type="number" name="num_points" class="w-full p-2 border rounded" required min="2" max="10">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Step Hours (1-24)</label>
                    <input type="number" name="step_hours" class="w-full p-2 border rounded" required min="1" max="24">
                </div>
                <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">Start Simulation</button>
            </form>
        </div>

        <!-- Shipments List -->
        <div class="bg-white shadow-md rounded-lg p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">Shipments</h2>
            {% if shipments %}
                <ul class="space-y-2">
                    {% for shipment in shipments %}
                        <li class="border-b py-2">
                            <a href="{{ url_for('track', tracking=shipment.tracking) }}" class="text-blue-600 hover:underline">
                                {{ shipment.title }} ({{ shipment.tracking }}): {{ shipment.status }}
                            </a>
                            {% if simulation_states %}
                                {% for state in simulation_states %}
                                    {% if state.tracking == shipment.tracking %}
                                        <form method="POST" action="{{ url_for('pause_simulation' if state.status == 'running' else 'continue_simulation', tracking=shipment.tracking) }}" class="inline">
                                            <button type="submit" class="text-sm text-white bg-{{ 'red' if state.status == 'running' else 'green' }}-600 py-1 px-2 rounded hover:bg-{{ 'red' if state.status == 'running' else 'green' }}-700">
                                                {{ 'Pause' if state.status == 'running' else 'Continue' }} Simulation
                                            </button>
                                        </form>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No shipments found.</p>
            {% endif %}
        </div>
    </div>
</body>
</html>
